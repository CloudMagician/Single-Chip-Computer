ORG		0000H
LJMP 	START 
ORG 	000BH
LJMP 	EINTT
ORG 	0040H

TAB:
DB 	0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H

START:
P4 		EQU 	0C0H
P4SW 	EQU 	0BBH
CLK 	EQU 	P4.4
DAT 	EQU 	P4.5
SW 		EQU 	P3.6

MOV 	P4SW,#70H
MOV 	DPTR,#TAB

LP:
MOV 	R3,#0
MOV 	R4,#0
MOV 	R5,#0

I1: 
MOV 	TMOD,#01H
 
MOV 	IE,#82H
 
SETB 	P1.1
SETB 	P1.4


MAIN: 
;direction
JB 		P3.7,SS2
MOV 	R0,#00101101B
MOV 	20H,R0
LJMP	SS1
SS2: 
MOV 	R0,#01111000B
MOV 	20H,R0

;speed
SS1:
JB 		P3.6,SPD
MOV 	R2,#0H
LJMP 	L0
SPD: 
MOV 	R2,#1H

;move
L0: 	
MOV 	R1,#4
MOV 	R0,20H
L1: 
MOV 	A,R0
RLC 	A
MOV 	P3.2,C
RLC 	A
MOV 	P1.0,C
MOV 	R0,A
LCALL 	COUT
LCALL 	MOVE
DJNZ 	R1,L1
LJMP 	MAIN


EINTT:
MOV		R7,#1
RETI


MOVE:
CJNE 	R2,#1,QUICK

MOV 	R6,#6
TIM: 
MOV 	TH0,#5DH
MOV 	TL0,#3EH
SETB 	TR0
MOV 	R7,#0H
TIMS: 
CJNE 	R7,#1H,TIMS
DJNZ 	R6,TIM
LJMP	OUT

QUICK: 
MOV 	TH0,#5DH
MOV 	TL0,#3EH
SETB 	TR0
MOV 	R7,#0H
TIMQ: 
CJNE 	R7,#1H,TIMQ
OUT:
RET


COUT:
MOV 	A,R3
CALL 	DIS
MOV 	A,R4
CALL 	DIS
MOV 	A,R5
CALL 	DIS

CJNE 	R3,#9,S1
MOV 	R3,#0
CJNE 	R4,#9,S2
MOV 	R4,#0
CJNE 	R5,#9,S3
MOV 	R5,#0 

S1: 
INC 	R3
LJMP 	STOP
S2: 
INC 	R4
LJMP 	STOP
S3: 
INC 	R5
LJMP 	STOP
STOP: 
RET


DIS: 
MOV 	21H,R0
MOVC 	A,@A+DPTR
MOV 	R0,#8
CLY:
CLR 	CLK
RLC 	A
MOV 	DAT,C
SETB 	CLK

DJNZ 	R0,CLY
MOV 	R0,21H
RET

END